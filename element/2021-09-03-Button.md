---
slug: Button
title: Button
authors: [lsh]
tags: [element,button]
---

按钮应该是必用的组件了

## 部分源码

```html
<template>
    <button
        class="el-button"
        @click="handleClick"
        :disabled="buttonDisabled || loading"
        :autofocus="autofocus"
        :type="nativeType"
        :class="[
            type ? 'el-button--' + type : '',
            buttonSize ? 'el-button--' + buttonSize : '',
            {
              'is-disabled': buttonDisabled,
              'is-loading': loading,
              'is-plain': plain,
              'is-round': round,
              'is-circle': circle
            }
        ]"
    >
        <i class="el-icon-loading" v-if="loading"></i>
        <i :class="icon" v-if="icon && !loading"></i>
        <span v-if="$slots.default"><slot></slot></span>
    </button>
</template>
<script>
    export default {
        inject: {
            elForm: {
                default: ''
            },
            elFormItem: {
              default: ''
            }
        },
        methods: {
            handleClick(evt) {
              this.$emit('click', evt);
            }
        }
    };
</script>
```

按钮提供的属性大多都是控制css样式，例如：

:::info

```js
props: {
    //...
    loading: Boolean,
    plain: Boolean,
    autofocus: Boolean,
    round: Boolean,
    circle: Boolean
},
```
:::

```html title="原生button的class" {5,12,13,14,15}
<button
    class="el-button"
    @click="handleClick"
    :disabled="buttonDisabled || loading"
    :autofocus="autofocus"
    :type="nativeType"
    :class="[
      type ? 'el-button--' + type : '',
      buttonSize ? 'el-button--' + buttonSize : '',
      {
        'is-disabled': buttonDisabled,
        'is-loading': loading,
        'is-plain': plain,
        'is-round': round,
        'is-circle': circle
      }
    ]"
  >
</button>
```
- :sunglasses:**autofocus** 控制是否添加原生的`autofocus`属性
- :grin:**loading** 控制渲染`is-loading`类
- :smile:**plain** 控制渲染`is-plain`类
- :laughing:**round** 控制渲染`is-round`类
- :innocent:**circle** 控制渲染`is-circle`类

以上几个属性的值类型都是`boolean`,官方文档是这样描述的：

|  参数   | 说明  | 类型 | 可选值 | 默认值
|  ----  | ----  | ---- | ---- | ----|
| autofocus  | 是否默认聚焦 | boolean | - | false
| loading  | 是否加载中状态 | boolean | - | false
| plain  | 是否朴素按钮 | boolean | - | false
| round  | 是否圆角按钮 | boolean | - | false
| circle  | 是否圆形按钮 | boolean | - | false

:capital_abcd:而`type`属性，控制着按钮的类型，但按钮并非只有两种样式，所以直接渲染`el-button-${type}`类,再在css文件中写对应的css类样式

```js
type ? 'el-button--' + type : '',
```

还有，关于**loading**属性值得一提的是，它会与**icon**位置产生冲突，所以当按钮是**loading**状态时，我们需要隐藏**icon**

Element是这样做的：

```html {2}
<i class="el-icon-loading" v-if="loading"></i>
<i :class="icon" v-if="icon && !loading"></i>
```

:point_right:`v-if="icon && !loading"`意味着**loading**展示的时候，**icon**会进入隐藏状态

此外，当按钮进入loading状态的时候，我们也需要让按钮状态变为不可点击：

```html
<button
    :disabled="buttonDisabled || loading"
>
<!-- ... -->
</button>
```
关于`buttonDisabled`,请往下看:point_down:：

## 按钮的大小控制

你可能注意到了Source Code中，出现了**inject**注入属性，如果你对此**Vue**的特性陌生的话，[点击这里查看](https://cn.vuejs.org/v2/api/#provide-inject)

同样的，如下的几个计算属性都和**inject**有关：
```js {12,15,18}
export default {
    inject: {
        elForm: {
            default: ''
        },
        elFormItem: {
            default: ''
        }
    },
    computed: {
        _elFormItemSize() {
            return (this.elFormItem || {}).elFormItemSize;
        },
        buttonSize() {
            return this.size || this._elFormItemSize || (this.$ELEMENT || {}).size;
        },
        buttonDisabled() {
            return this.disabled || (this.elForm || {}).disabled;
        }
    },
}
```
:::info Vue官方文档描述
provide 选项应该是一个对象或返回一个对象的函数。该对象包含可注入其子孙的 property
:::

我们找一下**elForm**组件的位置，截取关键源码如下：
```js title="packages/form/src/form.vue"
provide() {
    return {
        elForm: this
    };
},
```

我们找一下**elFormItem**组件的位置，截取关键源码如下：
```js title="packages/form/src/form-item.vue"
provide() {
    return {
        elFormItem: this
    };
},
```

Element官方让**el-form**和**el-form-item**都把自身注入进去，如此一来，子孙后代都能轻松访问它们的属性

对于**el-form**组件和**el-form-item**组件，它们都有**size**属性，

组件 |  参数   | 说明  | 类型 | 可选值 | 默认值
| ---- |  ----  | ----  | ---- | ---- | ----|
el-form | size  | 用于控制该表单内组件的尺寸 | string | medium / small / mini | false
el-form-item | size  | 用于控制该表单域下组件的尺寸 | string | medium / small / mini | false

所以，按钮的大小不仅和用户传入的**size**有关，还必须利用好父级（如果有的话）的size属性

那你是否认为这段代码应该这样写？
```diff title="el-button部分源码"
_elFormItemSize() {
-   return (this.elFormItem || {}).elFormItemSize;
+   return (this.elFormItem || {}).size;
},
```

如果我们的组件层级是这样的形式：
- el-form-item 
  -   el-button


那我们的思路是没错的，直接访问**el-form**的**size**属性，但是通常我们也会使用**el-form**，那么结构就会变为：
- el-form
  - el-form-item 
    - el-button

所以**el-form-item**的**size**也不应该单纯来源于自己，而是也和**el-form**有关

```js title="el-form-item部分源码"
export default {
    inject: ['elForm'],
    computed: {
        _formSize() {
            return this.elForm.size;
        },
        elFormItemSize() {
            return this.size || this._formSize;
        },
    }
}
```

:ferris_wheel:可以看出**el-form-item**优先使用自己的**size**，然后是**el-form**的**size**

我们的**button**同理：
```js title="el-button部分源码"
computed: {
    _elFormItemSize() {  //用来计算el-form的size（如果有的话）
        return (this.elFormItem || {}).elFormItemSize;
    },
    buttonSize() {  //计算当前按钮的真正大小
        return this.size || this._elFormItemSize || (this.$ELEMENT || {}).size;
    },
    buttonDisabled() {  //el-form禁用了，按钮也要禁用
        return this.disabled || (this.elForm || {}).disabled;
    }
},
```

但是上述又出现了一个陌生的东西`this.$ELEMENT`，这是Element的[全局配置](https://element.eleme.cn/#/zh-CN/component/quickstart)

默认是一个对象:point_right:`{size: '', zIndex: 2000}`，可以在Vue-cli的入口文件中声明`Vue.prototype.$ELEMENT`的值

## button-group

在使用多个按钮时候，`button-group`也经常用到

但`button-group`并没有多复杂，组件内容极为简单：

```html
<template>
  <div class="el-button-group">
    <slot></slot>
  </div>
</template>
```
虽然只是添加了一个类，但这里很有必要介绍一下`el-button-group`类的内容：

```css
.el-button + .el-button {  /*默认按钮之间会有间隙*/
    margin-left: 10px;
}
.el-button-group {   /*el-button-group包裹后会让间隙值为0*/
    .el-button + .el-button {
        margin-left: 0;
    }

    & + .el-button-group {
        margin-left: 10px;
    }
  }
```

## 总结

:lower_left_ballpoint_pen:Vue的`provide/inject`的优势在**el-button**组件中体现的淋漓尽致。我们应该学到如下知识：
- 灵活的运用Vue的class的[对象语法和数组语法](https://cn.vuejs.org/v2/guide/class-and-style.html#%E5%AF%B9%E8%B1%A1%E8%AF%AD%E6%B3%95)，切换组件的样式
- 在后代需要祖先的值的时候，考虑用**provide**性，而不是无脑使用**children**
    - **provide**还带来另一个好处，当层级为：
        ```html
        <el-form>
            <div>
                <el-form-item>
                    <div>
                        <el-button>
                            按钮
                        </el-button>
                    </div>
                </el-form-item>
            </div>
        </el-form>
        ```
        :heavy_check_mark:我们的size属性依旧能够生效
- 除此之外，**el-button**保留了原生属性`native-type`，日后在自己封装组件时，也需要考虑是否有必要暴露某些原生属性














